<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>
<div class="container">
    <div class="header">
        <h2>Who to follow</h2><a href="#" class="refresh">Refresh</a>
    </div>
    <ul class="suggestions">
        <li class="suggestion1">
            <img />
            <a href="#" target="_blank" class="username">this will not be displayed</a>
            <a href="#" class="close close1">x</a>
        </li>
        <li class="suggestion2">
            <img />
            <a href="#" target="_blank" class="username">neither this</a>
            <a href="#" class="close close2">x</a>
        </li>
        <li class="suggestion3">
            <img />
            <a href="#" target="_blank" class="username">nor this</a>
            <a href="#" class="close close3">x</a>
        </li>
    </ul>
</div>
<script src="https://cdn.bootcss.com/jquery/3.3.1/core.js"></script>
<script src="http://cdnjs.cloudflare.com/ajax/libs/rxjs/2.2.26/rx.js"></script>
<script src="http://cdnjs.cloudflare.com/ajax/libs/rxjs/2.2.26/rx.async.js"></script>
<script src="http://cdnjs.cloudflare.com/ajax/libs/rxjs/2.2.26/rx.coincidence.js"></script>
<script src="http://cdnjs.cloudflare.com/ajax/libs/rxjs/2.2.26/rx.binding.js"></script>
<script src="http://cdnjs.cloudflare.com/ajax/libs/rxjs/2.2.26/rx.time.js"></script>
<script src="http://cdnjs.cloudflare.com/ajax/libs/rxjs-dom/2.0.7/rx.dom.js"></script>
<script>

    /**
     * 在close点击时，清掉当前的item，并request，然后拿到一个值填入
     * 继承自closestream，拿到index的stream，拿到response的stream
     */


    var close1Button = document.querySelector('.close1');
    var close1ClickStream = Rx.Observable.fromEvent(close1Button, 'click');

    var refreshOneItemStream = close1ClickStream.map(function(item, index) {
        return index;
    });


    var refreshButton = document.querySelector('.refresh');
    var refreshClickStream = Rx.Observable.fromEvent(refreshButton, 'click');
    var requestStream = refreshClickStream.map(function () {
        var randomOffset = Math.floor(Math.random()*500);
        return 'https://api.github.com/users?since=' + randomOffset;
    })
    var startupRequestStream = Rx.Observable.just('https://api.github.com/users');
    var requestStream = Rx.Observable.merge(
        requestOnRefreshStream, startupRequestStream
    );

    var responseStream = requestStream
        .flatMap(function(requestUrl) {
            return Rx.Observable.fromPromise(jQuery.getJSON(requestUrl));
        });

    // first get one random user from the response
    var suggestion1Stream = responseStream
        .map(function(listUsers) {
            // get one random user from the list
            return listUsers[Math.floor(Math.random()*listUsers.length)];
        })
        .merge(
            //use null to sign that currently server hasn't responded
            refreshClickStream.map(function(){ return null; })
        );

    suggestion1Stream.subscribe(function(suggestion) {
        if (suggestion === null) {
            // hide the first suggestion DOM element
        }
        else {
            // show the first suggestion DOM element
            // and render the data
        }
    });

    responseStream.subscribe(function(response) {
        // render `response` to the DOM however you wish
    });
</script>
</body>
</html>